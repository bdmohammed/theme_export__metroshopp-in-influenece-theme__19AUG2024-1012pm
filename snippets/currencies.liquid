{%- liquid
  if settings.flag_currency
    assign fl = 'flags'
  endif
  assign sz = settings.size_currency
  assign cart_iso_code = cart.currency.iso_code
  assign shopify_cdn_url = 'https://cdn.shopify.com/static/images/flags/'
-%}

{%- if settings.flag_currency %}
  {{ 'currencies.css' | asset_url | stylesheet_tag }}
{% endif -%}

{%- if shop.enabled_currencies.size > 1 and settings.currency_type == '1' -%}
  {%- if linklists['currency-the4'].links.size > 0 -%}
    {%- assign ck_iso_code = '#' | append: cart_iso_code -%}
    {%- assign links_cur = linklists['currency-the4'].links | where: 'url', ck_iso_code -%}
    <div data-currency-wrap class="top-bar__currencies d-inline-block">
      <button data-dropdown-open data-position="bottom-end" data-id="dropdown_currencies{{sid}}">
        <span
          data-flags="{{sz}}"
          data-current
          class="d-inline-block {{fl}} lazyload flags-{{cart_iso_code}}"
        >
          <img
            src="{{ shopify_cdn_url | append: 'us.svg?width=30' }}"
            alt="United States"
            srcset="{{ shopify_cdn_url | append: 'us.svg?width=30' }} 30w"
            width="30"
            height="23"
            loading="lazy"
            data-img-current
          >
          {{- links_cur.first.title | default: cart_iso_code -}}
        </span>
        <svg class="ion-select-arrow " role="presentation" viewBox="0 0 19 12">
          <polyline fill="none" stroke="currentColor" points="17 2 9.5 10 2 2" fill-rule="evenodd" stroke-width="2" stroke-linecap="square"></polyline>
        </svg>
      </button>
      <div data-dropdown-wrapper class="dropdown__wrapper" id="dropdown_currencies{{sid}}">
        <div class="drop-arrow"></div>
        {%- for link_cur in linklists['currency-the4'].links -%}
          {%- assign iso_code = link_cur.url | remove: '#' | remove: ' ' -%}
          <button
            type="button"
            data-flags="{{sz}}"
            data-currency-item
            data-dropdown-off
            class="currency-item {{fl}} lazyload flags-{{iso_code}}{% if iso_code == cart_iso_code %} is--selected{% endif %}"
            data-iso="{{iso_code}}"
            data-country="{{iso_code}}"
          >
            <img
              src="{{ shopify_cdn_url | append: 'us.svg?width=30' }}"
              alt="United States"
              srcset="{{ shopify_cdn_url | append: 'us.svg?width=30' }} 30w"
              width="30"
              height="23"
              loading="lazy"
              data-img-current
            >
            {{ link_cur.title }}
          </button>
        {%- endfor -%}
      </div>
    </div>
  {%- else -%}
    <div data-currency-wrap class="top-bar__currencies d-inline-block">
      <button data-dropdown-open data-position="bottom-end" data-id="dropdown_currencies{{sid}}">
        <span
          data-flags="{{sz}}"
          data-current
          class="d-inline-block {{fl}} lazyload flags-{{cart_iso_code}}"
        >
          <img
            src="{{ shopify_cdn_url | append: 'us.svg?width=30' }}"
            alt="United States"
            srcset="{{ shopify_cdn_url | append: 'us.svg?width=30' }} 30w"
            width="30"
            height="23"
            loading="lazy"
            data-img-current
          >
          {{- cart_iso_code -}}
        </span>
        <svg class="ion-select-arrow " role="presentation" viewBox="0 0 19 12">
          <polyline fill="none" stroke="currentColor" points="17 2 9.5 10 2 2" fill-rule="evenodd" stroke-width="2" stroke-linecap="square"></polyline>
        </svg>
      </button>
      <div data-dropdown-wrapper class="dropdown__wrapper" id="dropdown_currencies{{sid}}">
        <div class="drop-arrow"></div>
        {%- for currency in shop.enabled_currencies -%}
          {%- assign iso_code = currency.iso_code -%}
          <button
            type="button"
            data-flags="{{sz}}"
            data-currency-item
            data-dropdown-off
            class="currency-item {{fl}} lazyload flags-{{iso_code}}{% if iso_code == cart_iso_code %} is--selected{% endif %}"
            data-iso="{{iso_code}}"
            data-country="{{iso_code}}"
          >
            <img
              src="{{ shopify_cdn_url | append: 'us.svg?width=30' }}"
              alt="United States"
              srcset="{{ shopify_cdn_url | append: 'us.svg?width=30' }} 30w"
              width="30"
              height="23"
              loading="lazy"
              data-img-current
            >
            {{ iso_code }}
          </button>
        {%- endfor -%}
      </div>
    </div>
  {%- endif -%}

{%- elsif settings.currency_type == '2' -%}
  {%- assign supported_codes = settings.supported_currencies | split: '|' -%}
  <div data-currency-wrap class="top-bar__currencies d-inline-block">
    <button data-dropdown-open data-position="bottom-end" data-id="dropdown_currencies{{ sid }}">
      <span data-current class="d-inline-block flags-{{ cart_iso_code | downcase }}">
        <img
          src="https://cdn.shopify.com/static/images/flags/{{ cart_iso_code | downcase }}.svg?width=30"
          alt="{{ cart_iso_code | upcase }}"
          width="30"
          height="23"
          loading="lazy"
        >
        {{ cart_iso_code | upcase }}
      </span>
      <svg class="ion-select-arrow" role="presentation" viewBox="0 0 19 12">
        <polyline fill="none" stroke="currentColor" points="17 2 9.5 10 2 2" fill-rule="evenodd" stroke-width="2" stroke-linecap="square"></polyline>
      </svg>
    </button>
    <div data-dropdown-wrapper class="dropdown__wrapper" id="dropdown_currencies{{ sid }}">
      <div class="drop-arrow"></div>
      <div class="dropdown__list">
        {%- for code in supported_codes -%}
          {%- assign array_money = code | split: '-' -%}
          {%- assign country_name = array_money[0] | strip | remove: ' ' -%}
          {%- assign country_iso_code = array_money[1] | strip | remove: ' ' -%}
          {%- assign currency_code = array_money[2] | strip | remove: ' ' -%}
          {%- assign currency_symbol = array_money[3] | strip | downcase -%}
          <button
            type="button"
            data-currency-item
            data-dropdown-off
            class="currency-item flags-{{ currency_code }} {% if currency_code == cart_iso_code %} is--selected{% endif %}"
            data-currency="{{ currency_code }}"
            data-country="{{ country_name }}"
          >
            <img
              src="https://cdn.shopify.com/static/images/flags/{{ country_iso_code }}.svg?width=30"
              srcset="https://cdn.shopify.com/static/images/flags/{{ country_iso_code }}.svg?width=30 30w"
              alt="{{ country_name }}"
              width="30"
              height="23"
              loading="lazy"
            >
            <span>
              {{- country_name }} - {{ currency_code }}
              {{ currency_symbol -}}
            </span>
          </button>
        {%- endfor -%}
      </div>
      {% comment %}
        {%- for localization in localization.available_countries -%}
          {%- if localization.currency.iso_code != blank -%}
            <button
              type="button"
              data-flagst4s="sm"
              data-currency-item=""
              data-dropdown-off=""
              class="t4s-currency-item flagst4s{% if localization.iso_code == localization.country.iso_code %} is--selected{% endif %}"
              data-iso="{{ localization.currency.iso_code }}"
              data-country="{{ localization.iso_code }}"
            >
              <img
                src="//cdn.shopify.com/static/images/flags/{{ localization.iso_code | downcase }}.svg?width=30"
                alt="{{ localization.name }}"
                srcset="//cdn.shopify.com/static/images/flags/{{ localization.iso_code | downcase }}.svg?width=30 30w"
                width="30"
                height="23"
                loading="lazy"
              >

              <span>
                {{- localization.name }} - {{ localization.currency.iso_code }}
                {{ localization.currency.symbol -}}
              </span>
            </button>
          {%- endif -%}
        {%- endfor -%}
      {% endcomment %}
    </div>
  </div>
{%- endif -%}
